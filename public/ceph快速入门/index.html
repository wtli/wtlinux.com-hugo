<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <title>Ceph快速入门 - wtlinux</title>
  <meta property="og:title" content="Ceph快速入门 - wtlinux" />
  <meta name="twitter:title" content="Ceph快速入门 - wtlinux" />
  <meta name="description" content="ceph-deploy工具在管理节点上的目录之外运行。任何具有网络连接和现代python环境和ssh（如Linux）的主机都应该可以工作">
  <meta property="og:description" content="ceph-deploy工具在管理节点上的目录之外运行。任何具有网络连接和现代python环境和ssh（如Linux）的主机都应该可以工作">
  <meta name="twitter:description" content="ceph-deploy工具在管理节点上的目录之外运行。任何具有网络连接和现代python环境和ssh（如Linux）的主机都应该可以工作">
  <meta name="author" content="wang tian"/>
  <meta property="og:site_name" content="wtlinux" />
  <meta property="og:url" content="http://www.wtlinux.com/ceph%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/" />
  <meta property="og:type" content="article" />
  <meta name="twitter:card" content="summary" />
  <meta name="generator" content="Hugo 0.111.3">
  <link rel="stylesheet" href="/css/style.css" media="all" />
  <link rel="stylesheet" href="/css/style-dark.css" media="all and (prefers-color-scheme: dark)" />

  <link rel="stylesheet" href="/css/syntax.css" media="all" />
  <link rel="stylesheet" href="/css/custom.css" media="all" />

  <script src="/js/script.js"></script>
  <script src="/js/custom.js"></script>
  <script defer src="/js/fontawesome.js"></script>
</head>

<body>

<header class="site-header">
  <nav class="site-navi">
    <h1 class="site-title"><a href="/">wtlinux</a></h1>
    <ul class="site-navi-items">
      <li class="site-navi-item-categories"><a href="/categories/" title="Categories">Categories</a></li>
      <li class="site-navi-item-tags"><a href="/tags/" title="Tags">Tags</a></li>
      <li class="site-navi-item-archives"><a href="/archives/" title="Archives">Archives</a></li>
      <li class="site-navi-item-about"><a href="/about/" title="About">About</a></li>
    </ul>
  </nav>
</header>
<hr class="site-header-bottom">

  <div class="main" role="main">
    <article class="article">
      
      
      <h1 class="article-title">Ceph快速入门</h1>
      
      <hr class="article-title-bottom">
      <ul class="article-meta">
        <li class="article-meta-date"><time>July 22, 2018</time></li>
        <li class="article-meta-categories">
          <a href="/categories/ops/">
            <i class="fas fa-folder"></i>
            ops
          </a>&nbsp;
        </li>
        <li class="article-meta-tags">
          <a href="/tags/ceph/">
            <i class="fas fa-tag"></i>
            ceph
          </a>&nbsp;
        </li>
      </ul>
      
<aside class="toc">
  <nav id="TableOfContents">
  <ul>
    <li><a href="#预安装">预安装</a>
      <ul>
        <li><a href="#ceph-deploy设置">Ceph-deploy设置</a></li>
        <li><a href="#ceph节点设置">Ceph节点设置</a></li>
        <li><a href="#概要">概要</a></li>
      </ul>
    </li>
    <li><a href="#存储集群">存储集群</a>
      <ul>
        <li><a href="#重置服务器">重置服务器</a></li>
        <li><a href="#创建一个集群">创建一个集群</a></li>
        <li><a href="#集群扩展">集群扩展</a></li>
        <li><a href="#存储检索对象数据">存储/检索对象数据</a></li>
      </ul>
    </li>
    <li><a href="#ceph客户端">CEPH客户端</a>
      <ul>
        <li><a href="#块设备快速启动">块设备快速启动</a></li>
        <li><a href="#文件系统快速入门">文件系统快速入门</a></li>
        <li><a href="#对象存储快速入门">对象存储快速入门</a></li>
      </ul>
    </li>
  </ul>
</nav>
</aside>
      <h1 id="安装ceph-deploy">安装ceph-deploy</h1>
<h2 id="预安装">预安装</h2>
<h3 id="ceph-deploy设置">Ceph-deploy设置</h3>
<ul>
<li>ceph-deploy工具在管理节点上的目录之外运行。任何具有网络连接和现代python环境和ssh（如Linux）的主机都应该可以工作</li>
</ul>
<p>架构图如下：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNbRwgy1fuggjt3mc6j30fc07tt90.jpg" alt=""></p>
<p>CentOS7：</p>
<pre tabindex="0"><code>//注册秘钥
sudo subscription-manager repos --enable=rhel-7-server-extras-rpms  
//安装并注册EPEL存储库
sudo yum install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm 
// 来添加yum仓库文件
cat &lt;&lt; EOM &gt; /etc/yum.repos.d/ceph.repo
[ceph-noarch]
name=Ceph noarch packages
baseurl=https://download.ceph.com/rpm-{ceph-stable-release}/el7/noarch
enabled=1
gpgcheck=1
type=rpm-md
gpgkey=https://download.ceph.com/keys/release.asc
EOM
//更新仓库并安装ceph-deploy
sudo yum update
sudo yum install ceph-deploy
</code></pre><h3 id="ceph节点设置">Ceph节点设置</h3>
<ul>
<li>管理节点必须具有对Ceph节点的无密码SSH访问。当ceph-deploy以用户身份登录到Ceph节点时，该特定用户必须具有无密码的sudo权限。</li>
</ul>
<p>CentOS7：</p>
<h4 id="安装时间服务器">安装时间服务器</h4>
<ul>
<li>建议安装时间服务器，特别是Ceph Monitor节点，以免时间不一致导致问题</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo yum install ntp ntpdate ntp-doc
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="安装ssh服务器">安装SSH服务器</h4>
<ul>
<li>确保SSH服务器在所有Ceph节点上运行</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo yum install openssh-server
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="创建ceph部署用户">创建Ceph部署用户</h4>
<ul>
<li>ceph-deploy实用程序必须以具有无密码sudo权限的用户身份登录到Ceph节点，因为它需要安装软件和配置文件而不提示输入密码。</li>
<li>最新版本的ceph-deploy支持&ndash;username选项，因此您可以指定任何具有无密码sudo的用户（包括root用户，但不建议这样做）。</li>
<li>我们建议在群集中的所有Ceph节点上为ceph-deploy创建特定用户。 请不要使用“ceph”作为用户名。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">//在每个Ceph节点上创建一个新用户。
</span></span><span class="line"><span class="cl">ssh user@ceph-server
</span></span><span class="line"><span class="cl">sudo useradd -d /home/<span class="o">{</span>username<span class="o">}</span> -m <span class="o">{</span>username<span class="o">}</span>
</span></span><span class="line"><span class="cl">sudo passwd <span class="o">{</span>username<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">//对于添加到每个Ceph节点的新用户，请确保该用户具有sudo权限。
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;{username} ALL = (root) NOPASSWD:ALL&#34;</span> <span class="p">|</span> sudo tee /etc/sudoers.d/<span class="o">{</span>username<span class="o">}</span>
</span></span><span class="line"><span class="cl">sudo chmod <span class="m">0440</span> /etc/sudoers.d/<span class="o">{</span>username<span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="启动无秘钥登陆">启动无秘钥登陆</h4>
<ul>
<li>由于ceph-deploy不会提示输入密码，因此必须在admin节点上生成SSH密钥并将公钥分发给每个Ceph节点。 ceph-deploy将尝试为初始监视器生成SSH密钥。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">//生成SSH密钥，但不要使用sudo或root用户。将密码保留为空
</span></span><span class="line"><span class="cl">ssh-keygen
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Generating public/private key pair.
</span></span><span class="line"><span class="cl">Enter file in which to save the key <span class="o">(</span>/ceph-admin/.ssh/id_rsa<span class="o">)</span>:
</span></span><span class="line"><span class="cl">Enter passphrase <span class="o">(</span>empty <span class="k">for</span> no passphrase<span class="o">)</span>:
</span></span><span class="line"><span class="cl">Enter same passphrase again:
</span></span><span class="line"><span class="cl">Your identification has been saved in /ceph-admin/.ssh/id_rsa.
</span></span><span class="line"><span class="cl">Your public key has been saved in /ceph-admin/.ssh/id_rsa.pub.
</span></span><span class="line"><span class="cl">//将密钥复制到每个Ceph节点，将<span class="o">{</span>username<span class="o">}</span>替换为您使用Create a Ceph Deploy User创建的用户名。
</span></span><span class="line"><span class="cl">ssh-copy-id <span class="o">{</span>username<span class="o">}</span>@node1
</span></span><span class="line"><span class="cl">ssh-copy-id <span class="o">{</span>username<span class="o">}</span>@node2
</span></span><span class="line"><span class="cl">ssh-copy-id <span class="o">{</span>username<span class="o">}</span>@node3
</span></span><span class="line"><span class="cl">//推荐修改ceph-deploy管理节点的〜/.ssh/config文件，以便ceph-deploy可以以您创建的用户身份登录到Ceph节点
</span></span><span class="line"><span class="cl">//而无需在每次执行时指定--username <span class="o">{</span>username<span class="o">}</span>部署。
</span></span><span class="line"><span class="cl">//这有一个额外的好处，即简化ssh和scp的使用。 将<span class="o">{</span>username<span class="o">}</span>替换为您创建的用户名：
</span></span><span class="line"><span class="cl">Host node1
</span></span><span class="line"><span class="cl">   Hostname node1
</span></span><span class="line"><span class="cl">   User <span class="o">{</span>username<span class="o">}</span>
</span></span><span class="line"><span class="cl">Host node2
</span></span><span class="line"><span class="cl">   Hostname node2
</span></span><span class="line"><span class="cl">   User <span class="o">{</span>username<span class="o">}</span>
</span></span><span class="line"><span class="cl">Host node3
</span></span><span class="line"><span class="cl">   Hostname node3
</span></span><span class="line"><span class="cl">   User <span class="o">{</span>username<span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="打开网络">打开网络</h4>
<p>编辑/etc/sysconfig/network-scripts/ifcfg-eth0修改ONBOOT=yes</p>
<h4 id="确保连通性">确保连通性</h4>
<p>在/etc/hosts中添加各主机名和IP地址的解析</p>
<h4 id="开放端口">开放端口</h4>
<p>Ceph Monitor默认端口6789</p>
<p>Ceph OSDs默认端口在6800-7300端口之间通信</p>
<h4 id="关闭防火墙">关闭防火墙</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">systemctl stop firewalld
</span></span><span class="line"><span class="cl">systemctl disable firewalld
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="更精准配置防火墙">更精准配置防火墙</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">//Ceph Mon节点
</span></span><span class="line"><span class="cl">sudo firewall-cmd --zone<span class="o">=</span>public --add-service<span class="o">=</span>ceph-mon --permanent
</span></span><span class="line"><span class="cl">//OSDs and MDSs
</span></span><span class="line"><span class="cl">sudo firewall-cmd --zone<span class="o">=</span>public --add-service<span class="o">=</span>ceph --permanent
</span></span><span class="line"><span class="cl">//让配置生效
</span></span><span class="line"><span class="cl">sudo firewall-cmd --reload
</span></span><span class="line"><span class="cl">//防火墙规则
</span></span><span class="line"><span class="cl">sudo iptables -A INPUT -i <span class="o">{</span>iface<span class="o">}</span> -p tcp -s <span class="o">{</span>ip-address<span class="o">}</span>/<span class="o">{</span>netmask<span class="o">}</span> --dport <span class="m">6789</span> -j ACCEPT
</span></span><span class="line"><span class="cl">//保存配置
</span></span><span class="line"><span class="cl">/sbin/service iptables save
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="tty">tty</h4>
<p>使用visudo配置sudo权限</p>
<h4 id="selinux">selinux</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo setenforce <span class="m">0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="依赖包">依赖包</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo yum install yum-plugin-priorities
</span></span><span class="line"><span class="cl">sudo yum install yum-plugin-priorities --enablerepo<span class="o">=</span>rhel-7-server-optional-rpms
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="概要">概要</h3>
<p>这样就完成了安装前配置了。下一步，开始集群部署。</p>
<h2 id="存储集群">存储集群</h2>
<p>搭建此集群之前，请先完成初始化设置。</p>
<p>集群拓扑图如下：</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNbRwgy1fuigvj38fyj30e807kaac.jpg" alt=""></p>
<p>我们将在管理节点上使用ceph-deploy启动Ceph存储集群。创建一个三个Ceph节点集群，以便您可以探索Ceph功能。</p>
<p>第一步：创建一个带有一个Ceph Monitor和三个Ceph OSD守护进程的Ceph存储集群。</p>
<p>第二步：一旦群集达到活动+干净状态，通过添加第四个Ceph OSD，一个元数据服务器和另外两个Ceph监视器守护进程来扩展它。</p>
<p>第三步：为获得最佳结果，请在管理节点上创建一个目录，以维护ceph-deploy为您的集群生成的配置文件和密钥。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">mkdir my-cluster
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> my-cluster
</span></span></code></pre></td></tr></table>
</div>
</div><p>ceph-deploy实用程序将文件输出到当前目录。执行ceph-deploy时，请确保您位于此目录中。</p>
<p><!-- raw HTML omitted -->注意:如果您以其他用户身份登录，请不要使用sudo调用ceph-deploy或以root身份运行它，因为它不会发出远程主机上所需的sudo命令。<!-- raw HTML omitted --></p>
<h3 id="重置服务器">重置服务器</h3>
<ul>
<li>如果您遇到麻烦并且想重新开始，请执行以下操作以清除Ceph软件包，并清除其所有数据和配置：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ceph-deploy purge <span class="o">{</span>ceph-node<span class="o">}</span> <span class="o">[{</span>ceph-node<span class="o">}]</span>
</span></span><span class="line"><span class="cl">ceph-deploy purgedata <span class="o">{</span>ceph-node<span class="o">}</span> <span class="o">[{</span>ceph-node<span class="o">}]</span>
</span></span><span class="line"><span class="cl">ceph-deploy forgetkeys
</span></span><span class="line"><span class="cl">rm ceph.*
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>如果执行purge，则必须重新安装Ceph。最后一个rm命令删除在先前安装期间由本地ceph-deploy写出的所有文件。</li>
</ul>
<h3 id="创建一个集群">创建一个集群</h3>
<ul>
<li>在您为保存配置详细信息而创建的目录的管理节点上，使用ceph-deploy执行以下步骤。</li>
</ul>
<h4 id="创建集群">创建集群</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ceph-deploy new <span class="o">{</span>initial-monitor-node<span class="o">(</span>s<span class="o">)}</span>
</span></span><span class="line"><span class="cl">例：
</span></span><span class="line"><span class="cl">ceph-deploy new node1
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="配置网络">配置网络</h4>
<ul>
<li>如果您有多个网络接口，请在Ceph配置文件的[global]部分下添加公共网络设置。有关详细信息，请参阅<a href="http://docs.ceph.com/docs/master/rados/configuration/network-config-ref">网络配置</a>参考</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">public <span class="nv">network</span> <span class="o">=</span> <span class="o">{</span>ip-address<span class="o">}</span>/<span class="o">{</span>bits<span class="o">}</span>
</span></span><span class="line"><span class="cl">例：
</span></span><span class="line"><span class="cl">public <span class="nv">network</span> <span class="o">=</span> 10.1.2.0/24
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ipv6配置">IPv6配置</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">echo</span> ms <span class="nb">bind</span> <span class="nv">ipv6</span> <span class="o">=</span> <span class="nb">true</span> &gt;&gt; ceph.conf
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="安装ceph包">安装Ceph包</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ceph-deploy install <span class="o">{</span>ceph-node<span class="o">}</span> <span class="o">[</span>...<span class="o">]</span>
</span></span><span class="line"><span class="cl">例:
</span></span><span class="line"><span class="cl">ceph-deploy install node1 node2 node3
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ceph-deploy实用程序将在每个节点上安装Ceph。</li>
</ul>
<h4 id="部署初始监视器并收集密钥">部署初始监视器并收集密钥</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ceph-deploy mon create-initial
</span></span></code></pre></td></tr></table>
</div>
</div><p>完成此过程后，您的本地目录应具有以下密钥环：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ceph.client.admin.keyring
</span></span><span class="line"><span class="cl">ceph.bootstrap-mgr.keyring
</span></span><span class="line"><span class="cl">ceph.bootstrap-osd.keyring
</span></span><span class="line"><span class="cl">ceph.bootstrap-mds.keyring
</span></span><span class="line"><span class="cl">ceph.bootstrap-rgw.keyring
</span></span><span class="line"><span class="cl">ceph.bootstrap-rbd.keyring
</span></span></code></pre></td></tr></table>
</div>
</div><p><!-- raw HTML omitted -->注意:如果此过程失败并显示类似于“无法找到/etc/ceph/ceph.client.admin.keyring”的消息，请确保ceph.conf中为监视节点列出的IP是公网IP，而不是私有IP。<!-- raw HTML omitted --></p>
<h4 id="优化deploy节点">优化deploy节点</h4>
<ul>
<li>使用ceph-deploy将配置文件和管理密钥复制到您的管理节点和Ceph节点，这样您就可以使用ceph CLI而无需在每次执行命令时指定监视器地址和ceph.client.admin.keyring。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ceph-deploy admin <span class="o">{</span>ceph-node<span class="o">(</span>s<span class="o">)}</span>
</span></span><span class="line"><span class="cl">例：
</span></span><span class="line"><span class="cl">ceph-deploy admin node1 node2 node3
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="部署管理节点">部署管理节点</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ceph-deploy mgr create node1  *Required only <span class="k">for</span> luminous+ builds, i.e &gt;<span class="o">=</span> 12.x builds*
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="添加三个osd节点">添加三个OSD节点</h4>
<ul>
<li>出于这些说明的目的，我们假设您在每个节点中都有一个名为/ dev / vdb的未使用磁盘。确保设备当前未使用且不包含任何重要数据。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ceph-deploy osd create –data <span class="o">{</span>device<span class="o">}</span> <span class="o">{</span>ceph-node<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">例：
</span></span><span class="line"><span class="cl">ceph-deploy osd create --data /dev/vdb node1
</span></span><span class="line"><span class="cl">ceph-deploy osd create --data /dev/vdb node2
</span></span><span class="line"><span class="cl">ceph-deploy osd create --data /dev/vdb node3
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="检查集群健康">检查集群健康</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">//如果健康会返回OK
</span></span><span class="line"><span class="cl">ssh node1 sudo ceph health
</span></span><span class="line"><span class="cl">//更详细的集群状态
</span></span><span class="line"><span class="cl">ssh node1 sudo ceph -s
</span></span></code></pre></td></tr></table>
</div>
</div><p>至此，如果健康会返回OK，Ceph集群创建完成。</p>
<h3 id="集群扩展">集群扩展</h3>
<ul>
<li>启动并运行基本群集后，下一步是扩展群集。将Ceph元数据服务器添加到node1。然后将Ceph Monitor和Ceph Manager添加到node2和node3，以提高可靠性和可用性。</li>
</ul>
<p>架构拓扑图如下：</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNbRwgy1fuijq5gutsj30fi0b4dg9.jpg" alt=""></p>
<h4 id="添加元数据服务器">添加元数据服务器</h4>
<ul>
<li>要使用CephFS，您至少需要一个元数据服务器。执行以下操作以创建元数据服务器：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ceph-deploy mds create <span class="o">{</span>ceph-node<span class="o">}</span>
</span></span><span class="line"><span class="cl">例：
</span></span><span class="line"><span class="cl">ceph-deploy mds create node1
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="添加监视器">添加监视器</h4>
<ul>
<li>Ceph存储集群需要至少运行一个Ceph Monitor和Ceph Manager。</li>
<li>为了实现高可用性，Ceph存储集群通常运行多个Ceph监视器，因此单个Ceph监视器的故障不会导致Ceph存储集群崩溃。</li>
<li>Ceph使用Paxos算法，该算法需要大多数监视器（即比N/2更多，其中N是监视器的数量）才能形成法定人数。虽然这不是必需的，但监视器的数量往往越多更好。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">//将两个Ceph监视器添加到您的群集：
</span></span><span class="line"><span class="cl">ceph-deploy mon add <span class="o">{</span>ceph-nodes<span class="o">}</span>
</span></span><span class="line"><span class="cl">例：
</span></span><span class="line"><span class="cl">ceph-deploy mon add node2 node3
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>一旦你添加了新的Ceph监视器，Ceph将开始同步监视器并形成一个法定人数。您可以通过执行以下操作来检查仲裁状态：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ceph quorum_status --format json-pretty
</span></span></code></pre></td></tr></table>
</div>
</div><p><!-- raw HTML omitted -->提示：当您使用多个监视器运行Ceph时，您应该在每个监视器主机上安装和配置NTP。确保监视器时间是同步的。<!-- raw HTML omitted --></p>
<h4 id="添加管理器">添加管理器</h4>
<ul>
<li>Ceph Manager守护进程以主/备用模式运行。部署其他管理器守护程序可确保在一个守护程序或主机发生故障时，另一个守护程序或主机可以在不中断服务的情况下进行接管。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">//部署其他管理器守护程序
</span></span><span class="line"><span class="cl">ceph-deploy mgr create node2 node3
</span></span><span class="line"><span class="cl">//查看备用管理器
</span></span><span class="line"><span class="cl">ssh node1 sudo ceph -s
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="添加rgw实例">添加RGW实例</h4>
<ul>
<li>要使用Ceph的Ceph对象网关组件，必须部署RGW实例。执行以下命令以创建RGW的新实例：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ceph-deploy rgw create <span class="o">{</span>gateway-node<span class="o">}</span>
</span></span><span class="line"><span class="cl">例：
</span></span><span class="line"><span class="cl">ceph-deploy rgw create node1
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>默认情况下，RGW实例将侦听端口7480.可以通过在运行RGW的节点上编辑ceph.conf来更改此设置，如下所示：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>client<span class="o">]</span>
</span></span><span class="line"><span class="cl">rgw <span class="nv">frontends</span> <span class="o">=</span> civetweb <span class="nv">port</span><span class="o">=</span><span class="m">80</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>要使用IPv6地址，请使用：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>client<span class="o">]</span>
</span></span><span class="line"><span class="cl">rgw <span class="nv">frontends</span> <span class="o">=</span> civetweb <span class="nv">port</span><span class="o">=[</span>::<span class="o">]</span>:80
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="存储检索对象数据">存储/检索对象数据</h3>
<ul>
<li>
<p>要将对象数据存储在Ceph存储集群中，Ceph客户端必须：</p>
<p>1.设置对象名称</p>
<p>2.指定一个<a href="http://docs.ceph.com/docs/master/rados/operations/pools">pool</a></p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">//查找对象位置
</span></span><span class="line"><span class="cl">ceph osd map <span class="o">{</span>poolname<span class="o">}</span> <span class="o">{</span>object-name<span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="练习找到一个对象">练习找到一个对象</h4>
<ul>
<li>作为练习，让我们创建一个对象。在命令行上使用rados put命令指定对象名称，包含某些对象数据的测试文件的路径和池名称。例如：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">echo</span> <span class="o">{</span>Test-data<span class="o">}</span> &gt; testfile.txt
</span></span><span class="line"><span class="cl">ceph osd pool create mytest <span class="m">8</span>
</span></span><span class="line"><span class="cl">rados put <span class="o">{</span>object-name<span class="o">}</span> <span class="o">{</span>file-path<span class="o">}</span> --pool<span class="o">=</span>mytest
</span></span><span class="line"><span class="cl">rados put test-object-1 testfile.txt --pool<span class="o">=</span>mytest
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>要验证Ceph存储集群是否存储了该对象，请执行以下命令：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">rados -p mytest ls
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>确定对象位置</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ceph osd map <span class="o">{</span>pool-name<span class="o">}</span> <span class="o">{</span>object-name<span class="o">}</span>
</span></span><span class="line"><span class="cl">ceph osd map mytest test-object-1
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Ceph应该输出对象的位置。例如</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">osdmap e537 pool <span class="s1">&#39;mytest&#39;</span> <span class="o">(</span>1<span class="o">)</span> object <span class="s1">&#39;test-object-1&#39;</span> -&gt; pg 1.d1743484 <span class="o">(</span>1.4<span class="o">)</span> -&gt; up <span class="o">[</span>1,0<span class="o">]</span> acting <span class="o">[</span>1,0<span class="o">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>要删除测试对象，只需使用rados rm命令将其删除即可。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">rados rm test-object-1 --pool<span class="o">=</span>mytest
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>要删除mytest pool</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ceph osd pool rm mytest
</span></span></code></pre></td></tr></table>
</div>
</div><p>（出于安全原因，您需要根据提示提供其他参数;删除pool会破坏数据。）</p>
<p>随着集群的发展，对象位置可能会动态变化。 Ceph动态重新平衡的一个好处是Ceph使您不必手动执行数据迁移或平移。</p>
<h2 id="ceph客户端">CEPH客户端</h2>
<h3 id="块设备快速启动">块设备快速启动</h3>
<ul>
<li>块设备快速启动之前，您必须先执行“存储群集快速入门”中的步骤。在使用Ceph块设备之前，请确保您的Ceph存储群集处于活动+干净状态。</li>
<li>Ceph块设备也称为RBD或RADOS块设备。</li>
</ul>
<p>拓扑图如下：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNbRwgy1fuimcnau0ij30ez03bmx8.jpg" alt=""></p>
<ul>
<li>您可以为您的ceph-client节点使用虚拟机，但不要在与Ceph存储群集节点相同的物理节点上执行以下过程（除非您使用VM）。</li>
</ul>
<h4 id="安装ceph">安装Ceph</h4>
<ul>
<li>验证您是否具有适当版本的Linux内核。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">lsb_release -a
</span></span><span class="line"><span class="cl">uname -r
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>在admin节点上，使用ceph-deploy在ceph-client节点上安装Ceph。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ceph-deploy install ceph-client
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>在admin节点上，使用ceph-deploy将Ceph配置文件和ceph.client.admin.keyring复制到ceph-client。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ceph-deploy admin ceph-client
</span></span></code></pre></td></tr></table>
</div>
</div><p>ceph-deploy实用程序将密钥环复制到/etc/ceph目录。确保密钥环文件具有适当的读取权限（例如，sudo chmod  +r /etc/ceph/ceph.client.admin.keyring）。</p>
<h4 id="创建块设备pool">创建块设备pool</h4>
<ul>
<li>在管理节点上，使用ceph工具创建pool（我们建议使用名称&rsquo;rbd&rsquo;）。</li>
<li>在管理节点上，使用rbd工具初始化池以供RBD使用：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">rbd pool init &lt;pool-name&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="配置块设备">配置块设备</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">//在ceph-client节点上，创建块设备映像。
</span></span><span class="line"><span class="cl">rbd create foo --size <span class="m">4096</span> --image-feature layering <span class="o">[</span>-m <span class="o">{</span>mon-IP<span class="o">}]</span> <span class="o">[</span>-k /path/to/ceph.client.admin.keyring<span class="o">]</span>
</span></span><span class="line"><span class="cl">//在ceph-client节点上，将图像映射到块设备。
</span></span><span class="line"><span class="cl">sudo rbd map foo --name client.admin <span class="o">[</span>-m <span class="o">{</span>mon-IP<span class="o">}]</span> <span class="o">[</span>-k /path/to/ceph.client.admin.keyring<span class="o">]</span>
</span></span><span class="line"><span class="cl">//通过在ceph-client节点上创建文件系统来使用块设备。
</span></span><span class="line"><span class="cl">sudo mkfs.ext4 -m0 /dev/rbd/rbd/foo
</span></span><span class="line"><span class="cl">This may take a few moments.
</span></span><span class="line"><span class="cl">//在ceph-client节点上挂载文件系统。
</span></span><span class="line"><span class="cl">sudo mkdir /mnt/ceph-block-device
</span></span><span class="line"><span class="cl">sudo mount /dev/rbd/rbd/foo /mnt/ceph-block-device
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> /mnt/ceph-block-device
</span></span></code></pre></td></tr></table>
</div>
</div><p>选项：将块设备配置为自动映射并在引导时挂载（并在关闭时卸载/取消映射） - 请参阅<a href="http://docs.ceph.com/docs/master/man/8/rbdmap">rbdmap</a>联机帮助页。</p>
<p>更多请参阅： <a href="http://docs.ceph.com/docs/master/rbd">block devices</a></p>
<h3 id="文件系统快速入门">文件系统快速入门</h3>
<ul>
<li>要使用CephFS快速入门指南，您必须首先执行“存储群集快速入门”指南中的过程。在管理主机上执行此快速入门。</li>
</ul>
<h4 id="先决条件">先决条件</h4>
<ul>
<li>验证您是否具有适当版本的Linux内核。有关详细信息，请参阅<a href="http://docs.ceph.com/docs/master/start/os-recommendations">OS建议</a></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">lsb_release -a
</span></span><span class="line"><span class="cl">uname -r
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>在admin节点上，使用ceph-deploy在ceph-client节点上安装Ceph。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ceph-deploy install ceph-client
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>确保Ceph存储群集正在运行并处于活动+干净状态。此外，请确保至少运行一个Ceph元数据服务器。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ceph -s <span class="o">[</span>-m <span class="o">{</span>monitor-ip-address<span class="o">}]</span> <span class="o">[</span>-k <span class="o">{</span>path/to/ceph.client.admin.keyring<span class="o">}]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="创建一个文件系统">创建一个文件系统</h4>
<ul>
<li>您已经创建了MDS<a href="#%E5%AD%98%E5%82%A8%E9%9B%86%E7%BE%A4">存储群集快速入门</a>，但在创建一些pool和文件系统之前它不会变为活动状态。请参阅<a href="http://docs.ceph.com/docs/master/cephfs/createfs/">创建Ceph文件系统</a>。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ceph osd pool create cephfs_data &lt;pg_num&gt;
</span></span><span class="line"><span class="cl">ceph osd pool create cephfs_metadata &lt;pg_num&gt;
</span></span><span class="line"><span class="cl">ceph fs new &lt;fs_name&gt; cephfs_metadata cephfs_data
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="创建一个秘密文件">创建一个秘密文件</h4>
<ul>
<li>Ceph存储集群在默认情况下启用身份验证的情况下运行。您应该有一个包含密钥的文件（即，不是密钥环本身）。要获取特定用户的密钥，请执行以下过程：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">//在密钥环文件中标识用户的密钥。例如:
</span></span><span class="line"><span class="cl">cat ceph.client.admin.keyring
</span></span><span class="line"><span class="cl">//复制将使用已安装的CephFS文件系统的用户的密钥。它应该看起来像这样：
</span></span><span class="line"><span class="cl"><span class="o">[</span>client.admin<span class="o">]</span>
</span></span><span class="line"><span class="cl">   <span class="nv">key</span> <span class="o">=</span> AQCj2YpRiAe6CxAA7/ETt7Hcl9IyxyYciVs47w<span class="o">==</span>
</span></span><span class="line"><span class="cl">//打开文本编辑器
</span></span><span class="line"><span class="cl">//将密钥粘贴到空文件中。它应该看起来像这样：
</span></span><span class="line"><span class="cl">AQCj2YpRiAe6CxAA7/ETt7Hcl9IyxyYciVs47w<span class="o">==</span>
</span></span><span class="line"><span class="cl">//使用用户名作为属性保存文件（例如，admin.secret）。
</span></span><span class="line"><span class="cl">//确保文件权限适合用户，但对其他用户不可见。
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="内核驱动程序">内核驱动程序</h4>
<ul>
<li>将CephFS挂载为内核驱动程序</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo mkdir /mnt/mycephfs
</span></span><span class="line"><span class="cl">sudo mount -t ceph <span class="o">{</span>ip-address-of-monitor<span class="o">}</span>:6789:/ /mnt/mycephfs
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Ceph存储集群默认使用身份验证。在“创建机密文件”部分中指定您创建的用户名和机密文件。例如：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo mount -t ceph 192.168.0.1:6789:/ /mnt/mycephfs -o <span class="nv">name</span><span class="o">=</span>admin,secretfile<span class="o">=</span>admin.secret
</span></span></code></pre></td></tr></table>
</div>
</div><p><!-- raw HTML omitted -->注意在管理节点上安装CephFS文件系统，而不是服务器节点。<!-- raw HTML omitted --></p>
<h4 id="用户空间的文件系统fuse">用户空间的文件系统（FUSE）</h4>
<ul>
<li>将CephFS挂载为用户空间（FUSE）中的文件系统。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo mkdir ~/mycephfs
</span></span><span class="line"><span class="cl">sudo ceph-fuse -m <span class="o">{</span>ip-address-of-monitor<span class="o">}</span>:6789 ~/mycephfs
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Ceph存储集群默认使用身份验证。如果密钥环不在默认位置（即/ etc / ceph），请指定密钥环：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo ceph-fuse -k ./ceph.client.admin.keyring -m 192.168.0.1:6789 ~/mycephfs
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="附加信息">附加信息</h4>
<p>有关其他信息，请参阅<a href="http://docs.ceph.com/docs/master/cephfs/">CephFS</a>。 CephFS不如Ceph Block Device和Ceph Object Storage稳定。如果遇到问题，请参阅<a href="http://docs.ceph.com/docs/master/cephfs/troubleshooting">故障排除</a></p>
<h3 id="对象存储快速入门">对象存储快速入门</h3>
<ul>
<li>从firefly（v0.80）开始，Ceph Storage大大简化了Ceph对象网关的安装和配置。Gateway守护程序嵌入Civetweb，因此您无需安装Web服务器或配置FastCGI.此外，ceph-deploy可以安装网关包，生成密钥，配置数据目录并为您创建网关实例。</li>
</ul>
<p>提示：Civetweb默认使用端口7480。您必须打开端口7480，或将端口设置为Ceph配置文件中的首选端口（例如，端口80）。</p>
<p>要启动Ceph对象网关，请按照以下步骤操作：</p>
<h4 id="安装ceph对象网关">安装Ceph对象网关</h4>
<ul>
<li>在客户端节点上执行预安装步骤。如果您打算使用Civetweb的默认端口7480，则必须使用firewall-cmd或iptables打开它。</li>
<li>从管理服务器的工作目录中，在客户机节点节点上安装Ceph对象网关包。例如：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ceph-deploy install --rgw &lt;client-node&gt; <span class="o">[</span>&lt;client-node&gt; ...<span class="o">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="创建ceph对象网关实例">创建Ceph对象网关实例</h4>
<ul>
<li>从管理服务器的工作目录中，在客户机节点上创建Ceph对象网关的实例。例如：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ceph-deploy rgw create &lt;client-node&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>网关运行后，您应该能够在端口7480上访问它。（例如，http//client-node:7480）。</p>
<h4 id="配置ceph对象网关实例">配置Ceph对象网关实例</h4>
<ul>
<li>要更改默认端口（例如，更改为端口80），请修改Ceph配置文件。 添加名为[client.rgw&lt;client-node&gt;]的部分，将<!-- raw HTML omitted -->替换为Ceph客户机节点的短节点名称（即hostname -s）。 例如，如果您的节点名称是client-node，请在[global]部分之后添加如下所示的部分：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>client.rgw.client-node<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">rgw_frontends</span> <span class="o">=</span> <span class="s2">&#34;civetweb port=80&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>注意确保在rgw_frontends键/值对中的port = <!-- raw HTML omitted -->之间不留空格。</p>
</blockquote>
<blockquote>
<p>要点：如果您打算使用端口80，请确保Apache服务器未运行，否则将与Civetweb冲突。 我们建议在这种情况下删除Apache。</p>
</blockquote>
<ul>
<li>要使新端口设置生效，请重新启动Ceph对象网关。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">// 在Red Hat Enterprise Linux 7和Fedora上，运行以下命令：
</span></span><span class="line"><span class="cl">sudo systemctl restart ceph-radosgw.service
</span></span><span class="line"><span class="cl">//在Red Hat Enterprise Linux 6和Ubuntu上，运行以下命令：
</span></span><span class="line"><span class="cl">sudo service radosgw restart <span class="nv">id</span><span class="o">=</span>rgw.&lt;short-hostname&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>最后，检查以确保您选择的端口在节点的防火墙（例如，端口80）上打开。 如果未打开，请添加端口并重新加载防火墙配置。 例如：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo firewall-cmd --list-all
</span></span><span class="line"><span class="cl">sudo firewall-cmd --zone<span class="o">=</span>public --add-port 80/tcp --permanent
</span></span><span class="line"><span class="cl">sudo firewall-cmd --reload
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>您应该能够进行未经身份验证的请求，并收到回复。 例如，没有这样的参数的请求：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">http://&lt;client-node&gt;:80
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>应该得到这样的回应：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;ListAllMyBucketsResult</span> <span class="na">xmlns=</span><span class="s">&#34;http://s3.amazonaws.com/doc/2006-03-01/&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;Owner&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;ID&gt;</span>anonymous<span class="nt">&lt;/ID&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;DisplayName&gt;&lt;/DisplayName&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/Owner&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;Buckets&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/Buckets&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/ListAllMyBucketsResult&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>有关其他管理和API详细信息，请参阅<a href="http://docs.ceph.com/docs/master/radosgw/config-ref">配置Ceph对象网关指南</a>。</p>

    </article>

    

    <div class="disqus-comments">
      <div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "wtlinux" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>

    <ul class="pager article-pager">
      <li class="pager-newer">
          <a href="/powerdns%E9%83%A8%E7%BD%B2/" data-toggle="tooltip" data-placement="top" title="PowerDNS部署">&lt; Newer</a>
      </li>
      <li class="pager-older">
        <a href="/hugo%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E6%95%99%E7%A8%8B/" data-toggle="tooltip" data-placement="top" title="Hugo搭建个人博客教程">Older &gt;</a>
      </li>
    </ul>
  </div>


<div class="site-footer">
  <div class="copyright">&copy; Copyright 2016 wtlinux</div>
  <ul class="site-footer-items">
    <li class="site-footer-item-about"><a href="/about/" title="About">About</a></li>
  </ul>
  <div class="powerdby">
    Powered by <a href="https://gohugo.io/">Hugo</a> and <a href="https://github.com/taikii/whiteplain">Whiteplain</a>
  </div>
</div>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-122643141-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

</body>
</html>
